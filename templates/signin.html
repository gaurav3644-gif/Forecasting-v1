{% extends "base.html" %}

{% block title %}Sign in{% endblock %}

{% block navbar %}{% endblock %}

{% block head %}
<style>
  body {
    background: radial-gradient(900px 420px at 50% 0%, rgba(13,110,253,0.10), transparent 60%),
                #f7f8fc;
  }
  .auth-wrap {
    min-height: calc(100vh - 40px);
    display: grid;
    place-items: center;
    padding: 24px 12px;
  }
  .auth-card {
    width: 100%;
    max-width: 520px;
    border-radius: 28px;
    border: 1px solid rgba(18,24,39,0.12);
    background: rgba(255,255,255,0.92);
    box-shadow: 0 18px 60px rgba(18,24,39,0.10);
    padding: 28px;
  }
  .auth-topbar {
    display: flex;
    justify-content: flex-start;
    margin-bottom: 10px;
  }
  .auth-logo {
    width: 52px;
    height: 52px;
    border-radius: 18px;
    display: grid;
    place-items: center;
    margin: 0 auto 10px auto;
    background: rgba(18,24,39,0.04);
  }
  .auth-title {
    text-align: center;
    font-weight: 400;
    letter-spacing: -0.02em;
    margin-bottom: 18px;
  }
  .divider {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 18px 0;
    color: rgba(18,24,39,0.55);
    font-size: 0.8rem;
    font-weight: 700;
  }
  .divider::before, .divider::after {
    content: "";
    flex: 1;
    height: 1px;
    background: rgba(18,24,39,0.12);
  }
  .btn-black {
    background: #000;
    color: #fff;
    border-radius: 14px;
    padding: 0.7rem 1rem;
    font-weight: 800;
  }
  .btn-black:hover { background: #111; color: #fff; }
  .btn-outline-soft {
    border-radius: 14px;
    border: 1px solid rgba(18,24,39,0.14);
    background: #fff;
    font-weight: 700;
    padding: 0.65rem 1rem;
  }
  .oauth-logo {
    width: 18px;
    height: 18px;
    display: inline-block;
    vertical-align: -3px;
    margin-right: 10px;
  }
  .muted-link { color: rgba(18,24,39,0.65); }
  .muted-link a { color: #0d6efd; text-decoration: none; font-weight: 700; }
  .muted-link a:hover { text-decoration: underline; }
</style>
{% endblock %}

{% block content %}
<div class="auth-wrap">
  <div class="auth-card">
    <div class="auth-topbar">
      <a class="btn btn-outline-secondary btn-sm" href="/">Go back</a>
    </div>
    <div class="auth-logo" aria-hidden="true">
      <span style="font-size: 26px;">&#129433;</span>
    </div>
    <h2 class="auth-title">Sign-in with One Time Password (OTP)</h2>

    {% if error %}
    <div class="alert alert-danger small">{{ error }}</div>
    {% endif %}

    {% if info %}
    <div class="alert alert-success small">{{ info }}</div>
    {% endif %}

    {% if stage == 'otp' %}
    <form method="post" action="/signin/verify" class="mb-2">
      <input type="hidden" name="next" value="{{ next or '' }}">
      <input type="hidden" name="otp_id" value="{{ otp_id or '' }}">
      <input type="hidden" name="email" value="{{ email or '' }}">
      <div class="mb-2">
        <label class="form-label fw-semibold">Email</label>
        <input class="form-control form-control-lg" type="email" value="{{ email or '' }}" disabled>
      </div>
      <div class="mb-2">
        <label class="form-label fw-semibold">6-digit code</label>
        <input class="form-control form-control-lg" name="code" inputmode="numeric" autocomplete="one-time-code" placeholder="123456" required>
        <div class="form-text">Code expires in 10 minutes.</div>
      </div>
      <button type="submit" class="btn btn-black w-100">Verify &amp; sign in</button>
    </form>
    <form method="post" action="/signin" class="mt-2">
      <input type="hidden" name="next" value="{{ next or '' }}">
      <input type="hidden" name="email" value="{{ email or '' }}">
      <button type="submit" class="btn btn-outline-soft w-100">Resend code</button>
    </form>
    {% else %}
    <form method="post" action="/signin" class="mb-2">
      <input type="hidden" name="next" value="{{ next or '' }}">
      <div class="mb-2">
        <label class="form-label fw-semibold">Email</label>
        <input class="form-control form-control-lg" type="email" name="email" placeholder="Your email address" value="{{ email or '' }}" required>
      </div>
      <button type="submit" class="btn btn-black w-100"><span data-i18n="auth_continue">Continue</span></button>
    </form>
    {% endif %}

    {% if stage != 'otp' %}
    <div class="divider">OR</div>

    <div class="d-grid gap-2">
      <a class="btn btn-outline-soft" href="/auth/google?next={{ next or '' }}">
        <svg class="oauth-logo" viewBox="0 0 48 48" aria-hidden="true" focusable="false">
          <path fill="#EA4335" d="M24 9.5c3.54 0 6.72 1.22 9.23 3.62l6.9-6.9C35.84 2.38 30.32 0 24 0 14.62 0 6.51 5.38 2.56 13.22l8.02 6.23C12.41 13.5 17.74 9.5 24 9.5z"/>
          <path fill="#4285F4" d="M46.5 24c0-1.65-.15-3.23-.43-4.75H24v9h12.64c-.54 2.9-2.18 5.36-4.64 7.02l7.14 5.53C43.35 36.9 46.5 30.95 46.5 24z"/>
          <path fill="#FBBC05" d="M10.58 28.45A14.5 14.5 0 0 1 9.5 24c0-1.54.27-3.03.78-4.45l-8.02-6.23A23.95 23.95 0 0 0 0 24c0 3.87.92 7.53 2.56 10.78l8.02-6.33z"/>
          <path fill="#34A853" d="M24 48c6.32 0 11.84-2.08 15.79-5.67l-7.14-5.53c-1.98 1.33-4.52 2.12-8.65 2.12-6.26 0-11.59-4-13.42-9.55l-8.02 6.33C6.51 42.62 14.62 48 24 48z"/>
          <path fill="none" d="M0 0h48v48H0z"/>
        </svg>
        <span data-i18n="auth_continue_google">Continue with Google</span>
      </a>
    </div>
    {% endif %}

  </div>
</div>
{% endblock %}
